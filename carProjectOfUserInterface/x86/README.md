# 智能小车控制模块

## 架构实现

1. 小车主程序兼容 Linux 和 Windows，基于`Python`的图形化用户界面。
2. 小车的核心控制模块在 Arduino 基于`C#`的硬件可交互型编程。

## 基本功能

- ### 主程序
  - 数值接收及显示，接收串口数据后输出至控制面板，可显示的数值有速度 ~~、油门、转向度、灯光状况~~。
  - 输出操作至 Arduino，使软件能操控硬件。
  - 拥有基本的音频播放及切换功能。
  - 对于不可预料的突发程序错误，有重启程序以进行重置。
- ### Arduino
  - 拥有对硬件设备的完全掌控权。
  - ~~可通过硬件设备控制硬件设备。~~（开发中）
  - 可接收计算机的指令，并对其作用于硬件设备上。
  - 在长时间运行下有优秀表现。

## 特别功能

- 在接入 Arduino 时，有多种方法可供选择。
- 在程序中，有各种按键，其中重启和关闭按钮需要按下两次，某些具有双位控制的按钮会因物理状态改变而改变其状态。
- 重启会保留当前环境，例如设备路径、设备波特率、音乐进度等，自动生成于`MainLog.txt`首部，以便重启后能立即恢复先前的状态。
- 在运行中的提示或突发的错误会输出至可视化界面，并自动保存至`MainLog.txt`中。
- 在程序中有关闭按键用以~~正常~~关闭程序。
- 在设备间的串口通信有基本通信协议以确保信息正确，即首位校验与长度校验。
- 音频可视化可提供在音频播放时的视觉表现 ~~，并传递至 Arduino 中以调用灯光效果~~。
- Arduino 可依据计算机的指示控制灯效，多达三种效果以上。

# 先决条件

安装所有需要的库

```
# Python==3.9

pip install -r requirement.txt
```

# 快速使用

### 连接
#### 目前提供三种连接Arduino的方式
1. 通过参数指定设备路径与波特率，可快速到达控制面板。
   - -d --dev DEVICE
   - -b --band BANDRATE
   ```
   python MainUI-REBUILD.py -d COM0 -b 115200
   ```
2. 在连接界面中选择设备路径~~与波特率~~后连接。
3. 通过自动检测来连接，仅支持常用波特率`9600`、`19200`、`115200`。

### 使用

1. Restart
   > 在遇到某些异常时使用，如无法正常接收到车辆的参数，无法向小车发送数据。
2. Exit
   > 退出主程序时的最好策略，~~全部~~资源会被正常释放。
3. Left Light & Right Light & Emergency Light
   > 左转灯、右转灯、应急灯
4. Import Music -- Previous & Next & Pause & Unpause
   > 导入音乐，点击后出现一个窗口用以导入音乐，导入完毕后会出现额外的四个按钮：`上一首`、`下一首`、`暂停`、`取消暂停`。

# 特别鸣谢

音频可视化采用了开源项目[Music Visualizer](https://gitlab.com/avirzayev/music-visualizer)中的音频可视化，由 Pygame 移植至 Tkinter

# 文件结构

### AudioVisual.py
   - 音频可视化。
### AutomaticConnect.py
   - 用于自动连接Arduino板。
### ExternalCommunication.py
   - 外部通信，即连接到Arduino的通信协议。
### ExternalFileController.py
   - 外部文件控制，即读或写外部文件，如配置文件，语言包，日志文件。
### JoyStick.py
   - 手柄控制（开发中）。
### MusicPlayer.py
   - 音乐播放器，后期将改为声音播放器。
### WidgetsProcess.py
   - 对于MainUI的小组件，通过重写接口使工作流更简洁。
### language.pak
   - 语言包，支持自定义。
### main.cfg
   - 主配置文件，可配置应用中的各种特性。
### requirement
   - 应用运行的先决条件，库。